<!DOCTYPE html>
<html>

<head>
    <title>NEX Login</title>
    <meta charset="UTF-8">
    <script src="./lib/angular-1.3.10.min.js"></script>
    <style type="text/css">
    ul {
        list-style: none;
    }
    
    li {
        padding: 20px 0;
    }
    
    a {
        color: #0087d5;
    }
    </style>
</head>

<body>
    <div ng-app="nexmp-showCredentials" ng-controller="nexmp-ctrl">
        <ul>
            <li ng-repeat="node in list">
                    <p>{{node.name}}</p>
                    <div ng-repeat="obj in node.item">
                        <div ng-if="obj.download === false">
                        <img ng-src="{{obj.url}}">
                        <br>
                        </div>
                        <div ng-if="obj.download === true">
                            <a href="{{obj.url}}" target="_blank">{{obj.url}}</a>
                            <br>
                        </div>
                     </div>
            </li>
        </ul>
    </div>
    <script type="text/javascript">
    //窗口关闭前清空本地存储
    window.onbeforeunload = function() {
        window.localStorage.removeItem("lookupCredentials");
    };
    //AnugarlJs
    angular.module('nexmp-showCredentials', [])
        .controller('nexmp-ctrl', function($scope, $timeout) {
            //检车是否是可下载文件 (zip/pdf)
            function needDownload(url) {
                //获取或追名
                var suffix = url.split(".");
                if (suffix) {
                    suffix = suffix[suffix.length - 1].toUpperCase();
                    //或追转化为大写后查看是否为ZIP/PDF
                    if (suffix === "ZIP" || suffix === "PDF") {
                        return true;
                    }
                }
                return false;
            }
            //
            $scope.list = [];
            //
            $timeout(function() {
                var store = JSON.parse(window.localStorage.getItem("lookupCredentials"));
                if (store) {
                    $scope.list = store.list;
                    $scope.list.forEach(function(curNode) {
                        curNode.item = [];
                        for(var key in curNode.url){
                            var obj ={};
                            obj.download = needDownload(curNode.url[key])
                            obj.url = curNode.url[key];
                            curNode.item[key] = obj;
                        }
                    });
                }
            });
        })
    </script>
</body>

</html>
