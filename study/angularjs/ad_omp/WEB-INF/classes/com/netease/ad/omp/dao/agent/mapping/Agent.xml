<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.netease.ad.omp.dao.agent.mapper.AgentMapper">
    <!-- 保存代理商信息 -->
    <insert id="insertAgent" parameterType="com.netease.ad.omp.entity.agent.Agent">
        INSERT INTO ad_agent(agent_id,agent_name,agent_url,contactor,mobile,email,province,city,address,
                             available_balance,recharge,available_reward_balance,reward_recharge,data_status,
                             create_time,update_time)
             VALUES(         #{agentId},#{agentName},#{agentUrl},#{contactor},#{mobile},#{email},#{province},#{city},#{address},
                             #{availableBalance},#{recharge},#{availableRewardBalance},#{rewardRecharge},#{dataStatus},
                             NOW(),#{updateTime})
    </insert>

    <select id="selectAgentById" parameterType="java.lang.Long" resultType="com.netease.ad.omp.entity.agent.Agent">
        SELECT COUNT(1) FROM ad_agent WHERE agent_id = #{agentId}
    </select>

    <!-- 查询所有代理商小时收入 -->
    <select id="selectAgentsRevenue" parameterType="java.util.HashMap" resultType="com.netease.ad.omp.entity.stat.AgentHourRevenue">
        SELECT  r.sta_date AS staDate,a.agent_id AS agentId,SUM(r.expend) AS expend,
                SUM(r.exposures) AS exposures,SUM(r.clicks) AS clicks,NOW() AS createTime,NOW() AS updateTime
        FROM sta_adv_hour_revenue r LEFT JOIN ad_advertiser a ON r.advertiser_id = a.dsp_advertiser_id
        WHERE r.sta_date> #{startTime} AND #{endTime} >= r.sta_date
          AND a.category= 1 AND a.channel =2
        GROUP BY r.sta_date,a.agent_id
    </select>


    <select id="selectAllAgent"  resultType="com.netease.ad.omp.entity.agent.Agent">
        SELECT id AS id,agent_id AS agentId,agent_name  AS agentName FROM ad_agent
    </select>

</mapper>